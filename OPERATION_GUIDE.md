# 甘特图项目操作指南

## 📖 项目概述

这是一个基于Vue.js + Go的甘特图项目管理系统，支持创建项目、管理阶段和任务、生成甘特图并导出为Excel文件。

### 🎯 核心功能
- ✅ 项目创建与管理
- ✅ 项目阶段规划
- ✅ 任务分配与跟踪
- ✅ 甘特图可视化（日/周/月视图）
- ✅ Excel导出功能
- ✅ 团队成员管理
- ✅ 进度跟踪

## 🚀 快速开始

### 环境要求
- Node.js >= 18.0
- Go >= 1.19
- PostgreSQL >= 12

### 1. 克隆项目
```bash
git clone <repository-url>
cd gantt-excel
```

### 2. 启动方式

#### 方式一：Docker Compose（推荐）
```bash
# 启动所有服务
docker-compose up -d

# 查看服务状态
docker-compose ps

# 查看日志
docker-compose logs -f
```

#### 方式二：手动启动

**启动数据库**
```bash
# 确保PostgreSQL运行并创建数据库
createdb gantt_excel
```

**启动后端服务**
```bash
cd backend
cp env.example .env
# 编辑 .env 文件配置数据库连接
go mod download
go run .
```

**启动前端服务**
```bash
cd frontend
cp env.example .env.local
# 编辑 .env.local 文件配置API地址
npm install
npm run dev
```

### 3. 访问应用
- 前端地址：http://localhost:5173
- 后端API：http://localhost:8080
- 测试页面：http://localhost:5173/test/gantt

## 📋 使用说明

### 身份验证
1. 首次访问会跳转到密码验证页面
2. 输入系统密码（默认：admin123）
3. 验证成功后可访问所有功能

### 项目管理

#### 创建项目
1. 点击"新建项目"按钮
2. 填写项目基本信息：
   - 项目名称（必填）
   - 项目描述
   - 开始日期（必填）
   - 结束日期（必填）
3. 点击"创建项目"

#### 项目详情页面
- 查看项目基本信息和统计数据
- 管理项目阶段
- 查看和编辑甘特图
- 管理团队成员

### 阶段管理

#### 添加阶段
1. 在项目详情页面点击"添加阶段"
2. 填写阶段信息：
   - 阶段名称（必填）
   - 开始日期（必填）
   - 结束日期（必填）
   - 阶段描述
   - 状态（待开始/进行中/已完成）
   - 进度（0-100%）
3. 保存阶段

#### 编辑阶段
- 在甘特图中点击阶段条可直接编辑
- 支持拖拽调整时间范围（开发中）

### 任务管理

#### 添加任务
1. 选择所属阶段
2. 填写任务信息：
   - 任务名称（必填）
   - 开始日期（必填）
   - 结束日期（必填）
   - 优先级（低/中/高/紧急）
   - 状态（待开始/进行中/已完成）
   - 进度（0-100%）
   - 指派成员
3. 保存任务

#### 任务跟踪
- 在甘特图中查看任务进度
- 点击任务条可编辑任务信息
- 支持批量更新任务状态

### 甘特图功能

#### 视图切换
- **日视图**：精确到天，适合短期项目规划
- **周视图**：以周为单位，适合中期项目管控
- **月视图**：以月为单位，适合长期项目概览

#### 甘特图操作
- **查看详情**：悬停显示任务/阶段详细信息
- **编辑条目**：点击甘特图条可直接编辑
- **时间对齐**：甘特图条精确对应时间轴
- **进度显示**：条内显示完成进度

### 团队管理

#### 添加成员
1. 在项目详情页面点击"添加成员"
2. 填写成员信息：
   - 姓名（必填）
   - 邮箱
   - 角色（PM/PO/前端/后端/UI/特效/音频/测试）
3. 保存成员

#### 任务分配
- 在创建/编辑任务时选择指派成员
- 支持一个任务分配给一个成员
- 成员头像会显示在甘特图中

### 导出功能

#### 单个项目导出
1. 在项目详情页面点击"导出Excel"
2. 系统生成包含甘特图的Excel文件
3. 自动下载到本地

#### 批量导出
1. 在项目列表页面选择多个项目
2. 点击"批量导出"
3. 系统为每个项目生成单独的Excel文件

## 🧪 测试功能

### 甘特图对齐测试
访问 `/test/gantt` 页面可以测试时间对齐修复效果：

1. **正常测试数据**
   - 验证标准情况下的时间对齐
   - 测试不同视图模式的一致性

2. **边界测试数据**
   - 验证超出项目范围的任务处理
   - 测试边界情况的鲁棒性

### 测试步骤
1. 切换不同测试数据集
2. 切换不同视图模式（日/周/月）
3. 检查甘特图条与时间轴的对齐精度
4. 查看浏览器控制台的调试信息

## 🔧 配置说明

### 前端配置 (frontend/.env.local)
```env
VITE_API_BASE_URL=http://localhost:8080/api/v1
VITE_APP_TITLE=甘特图项目管理系统
```

### 后端配置 (backend/.env)
```env
PORT=8080
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=password
DB_NAME=gantt_excel
DB_SSL_MODE=disable
ADMIN_PASSWORD=admin123
```

## 📊 API接口

### 项目相关
- `GET /api/v1/projects` - 获取项目列表
- `POST /api/v1/projects` - 创建项目
- `GET /api/v1/projects/{id}` - 获取项目详情
- `PUT /api/v1/projects/{id}` - 更新项目
- `DELETE /api/v1/projects/{id}` - 删除项目
- `GET /api/v1/projects/{id}/export` - 导出项目Excel

### 甘特图相关
- `GET /api/v1/gantt/{projectId}` - 获取甘特图数据

### 阶段相关
- `POST /api/v1/stages` - 创建阶段
- `PUT /api/v1/stages/{id}` - 更新阶段
- `DELETE /api/v1/stages/{id}` - 删除阶段

### 任务相关
- `POST /api/v1/tasks` - 创建任务
- `PUT /api/v1/tasks/{id}` - 更新任务
- `DELETE /api/v1/tasks/{id}` - 删除任务

### 成员相关
- `POST /api/v1/members` - 添加成员
- `PUT /api/v1/members/{id}` - 更新成员
- `DELETE /api/v1/members/{id}` - 删除成员

## 🐛 故障排除

### 常见问题

#### 1. 前端启动失败
```bash
# 清除缓存重新安装
rm -rf node_modules package-lock.json
npm install
```

#### 2. 后端数据库连接失败
- 检查PostgreSQL服务是否启动
- 确认数据库配置信息正确
- 确保数据库已创建

#### 3. 甘特图显示异常
- 检查项目开始/结束日期是否正确
- 确认任务/阶段时间在项目范围内
- 查看浏览器控制台错误信息

#### 4. Excel导出失败
- 检查后端服务是否正常运行
- 确认项目数据完整性
- 查看服务器日志

### 调试模式
开发模式下，浏览器控制台会输出详细的调试信息：
- 时间轴生成过程
- 甘特图条位置计算
- API请求响应
- 组件生命周期

## 📈 性能优化

### 前端优化
- 大量数据时启用虚拟滚动
- 使用防抖优化搜索功能
- 组件懒加载

### 后端优化
- 数据库查询优化
- 接口响应缓存
- 分页查询支持

## 🔒 安全考虑

- 密码验证中间件
- API接口权限控制
- 输入数据验证
- SQL注入防护

## 📞 技术支持

如遇到问题，请：
1. 查看本文档的故障排除部分
2. 检查浏览器控制台错误信息
3. 查看服务器日志
4. 提交Issue到项目仓库

---

**最后更新**：2024年12月 - 甘特图时间对齐修复版本